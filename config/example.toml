[proxy]
listen_addr = "0.0.0.0:7000"
upstream_addr = "10.0.0.10:7001"
worker_count = 4
reuse_port = true
pin_workers = false
batch_size = 64
max_sessions = 65536
min_datagram_bytes = 1
max_datagram_bytes = 1400
drop_udp_fragments = true
# Optional socket buffer tuning (bytes). Kernel may clamp requested values.
socket_recv_buffer_bytes = 4194304
socket_send_buffer_bytes = 4194304
# best-effort: exact fragment detection may not be available via standard UDP socket APIs
queue_capacity = 128
telemetry_queue_capacity = 32
critical_queue_capacity = 96
# Optional: if set, these override only the downstream (upstream->client) queues.
# Useful when you want small per-session upstream queues but a larger shared downstream buffer.
#downstream_telemetry_queue_capacity = 32
#downstream_critical_queue_capacity = 96
critical_overflow_policy = "drop_oldest"
critical_block_timeout_millis = 5
# Optional load-shedding: drop packets that wait too long in the downstream queue.
downstream_telemetry_ttl_millis = 100
downstream_critical_ttl_millis = 250
telemetry_prefixes = ["TELE:", "STAT:"]

[rate_limit]
ddos_limit = 800.0
per_ip_burst_packets = 1600.0
per_ip_bytes_per_second = 800000.0
per_ip_burst_bytes = 1600000.0
global_packets_per_second = 50000.0
global_burst_packets = 100000.0
global_bytes_per_second = 256000000.0
global_burst_bytes = 512000000.0
subnet_enabled = true
subnet_ipv4_prefix = 24
subnet_ipv6_prefix = 64
subnet_packets_per_second = 20000.0
subnet_burst_packets = 40000.0
subnet_bytes_per_second = 128000000.0
subnet_burst_bytes = 256000000.0
max_ip_buckets = 65536
max_subnet_buckets = 16384
idle_timeout_secs = 120

[anomaly]
enabled = true
model = "heuristic"
anomaly_threshold = 0.8
ddos_limit = 800.0
window_millis = 200
ema_alpha = 0.35
min_packets_per_window = 12
max_tracked_ips = 65536
idle_timeout_secs = 120
client_sync_check = true
client_sync_threshold_ms = 120.0
client_sync_weight = 0.35

[packet_validation]
enabled = false
strict_mode = true
require_checksum = false
strip_checksum_header = true

[mmr]
enabled = false
model = "heuristic"
mmr_threshold = 0.8
window_secs = 30
idle_timeout_secs = 600
max_tracked_ips = 65536

[flood_sim]
allow_non_local = false

[cookie]
enabled = true
mode = "compat"
secret = "replace-with-strong-secret"
token_ttl_secs = 20
tag_bytes = 16
max_tracked_peers = 65536
challenge_packets_per_second = 5000.0
challenge_burst_packets = 10000.0

[metrics]
enabled = true
listen_addr = "0.0.0.0:9100"
